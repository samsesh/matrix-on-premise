# Caddy Configuration for MatrixRTC with LiveKit
#
# This configuration shows how to set up endpoint routing for LiveKit SFU
# and lk-jwt-service under a single hostname.
#
# Place this in your Caddyfile or in /etc/caddy/Caddyfile

# HTTP configuration (for testing)
http://matrix-rtc.example.com {
    # Route for lk-jwt-service with livekit/jwt prefix
    @jwt_service path /livekit/jwt/sfu/get /livekit/jwt/healthz
    handle @jwt_service {
        uri strip_prefix /livekit/jwt
        reverse_proxy http://localhost:8083 {
            header_up Host {host}
            header_up X-Forwarded-Server {host}
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-For {remote_host}
        }
    }

    # Default route for LiveKit SFU
    handle {
        reverse_proxy http://localhost:7880 {
            header_up Host {host}
            header_up X-Forwarded-Server {host}
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-For {remote_host}
        }
    }
}

# HTTPS configuration (production)
# matrix-rtc.example.com {
#     # Caddy automatically handles SSL certificates via Let's Encrypt
#     
#     # Route for lk-jwt-service with livekit/jwt prefix
#     @jwt_service path /livekit/jwt/sfu/get /livekit/jwt/healthz
#     handle @jwt_service {
#         uri strip_prefix /livekit/jwt
#         reverse_proxy http://localhost:8083 {
#             header_up Host {host}
#             header_up X-Forwarded-Server {host}
#             header_up X-Real-IP {remote_host}
#             header_up X-Forwarded-For {remote_host}
#         }
#     }
#
#     # Default route for LiveKit SFU
#     handle {
#         reverse_proxy http://localhost:7880 {
#             header_up Host {host}
#             header_up X-Forwarded-Server {host}
#             header_up X-Real-IP {remote_host}
#             header_up X-Forwarded-For {remote_host}
#         }
#     }
# }
